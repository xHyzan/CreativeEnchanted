-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
Creative = {}
Tunnel.bindInterface("painel",Creative)
vSERVER = Tunnel.getInterface("painel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Current = ''
-----------------------------------------------------------------------------------------------------------------------------------------
-- PAINEL:OPENED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent('painel:Opened')
AddEventHandler('painel:Opened', function(Group)
    local Departmenty = vSERVER.Department(Group)
	Current = Group
    if Departmenty then
        SetNuiFocus(true, true)
        TransitionToBlurred(1000)
        SetCursorLocation(0.5, 0.5)
        TriggerEvent('hud:Active', false)
		TriggerEvent('dynamic:Close')
        SendNUIMessage({ Action = 'Open', Payload = vSERVER.Player() })
    end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- PAINEL:CLOSED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent('painel:Closed')
AddEventHandler('painel:Closed', function(Action)
	SetNuiFocus(false, false)
    SetCursorLocation(0.5, 0.5)
    TransitionFromBlurred(1000)
    TriggerEvent('hud:Active', true)
	SendNUIMessage({ Action = 'Close' })

	if Current and Action and Action:find('Refresh') then
		SetTimeout(200, function()
			TriggerEvent('painel:Opened', Current)
		end)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)
	SetCursorLocation(0.5,0.5)
	TransitionFromBlurred(1000)
	TriggerEvent("hud:Active",true)

	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- USER
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("User",function(Data,Callback)
	Callback(vSERVER.User(Data.Passport))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- AVATAR
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Avatar",function(Data,Callback)
	SetNuiFocus(false,false)
	SetCursorLocation(0.5,0.5)
	TransitionFromBlurred(1000)

	CreateThread(function()
		local Printing = false
		local Passport = Data.Passport
		local Camera = GetFollowPedCamViewMode()
		TriggerEvent("inventory:Buttons",{
			{ "E","Tirar Foto" },
			{ "H","Cancelar" }
		})

		SetFollowPedCamViewMode(4)

		while true do
			Wait(1)

			if GetFollowPedCamViewMode() ~= 4 then
				SetFollowPedCamViewMode(4)
			end

			if IsControlJustPressed(1,38) and not Printing then
				Printing = true

				exports["screenshot-basic"]:requestScreenshotUpload(GetConvar("Discord_PAINEL"),"files[]",{ encoding = "webp", quality = 0.75 },function(Data)
					if vSERVER.Avatar(Passport,json.decode(Data).attachments[1].url) then
						SendNUIMessage({ Action = "User", Payload = Passport })
						TriggerEvent("inventory:CloseButtons")
						SetFollowPedCamViewMode(Camera)
						SetCursorLocation(0.5,0.5)
						TransitionToBlurred(1000)
						SetNuiFocus(true,true)
					end
				end)

				break
			end

			if IsControlJustPressed(1,74) then
				TriggerEvent("inventory:CloseButtons")
				SetFollowPedCamViewMode(Camera)

				break
			end
		end
	end)

	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- MEDICPLAN
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("MedicPlan",function(Data,Callback)
	Callback(vSERVER.MedicPlan(Data.Passport))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- GETMEDICALRECORD
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("GetMedicalRecord",function(Data,Callback)
	Callback(vSERVER.GetMedicalRecord(Data.Id))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CREATEMEDICALRECORD
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("CreateMedicalRecord",function(Data,Callback)
	Callback(vSERVER.CreateMedicalRecord(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATEMEDICALRECORD
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("UpdateMedicalRecord",function(Data,Callback)
	Callback(vSERVER.UpdateMedicalRecord(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DESTROYMEDICALRECORD
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("DestroyMedicalRecord",function(Data,Callback)
	Callback(vSERVER.DestroyMedicalRecord(Data.Id))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SEARCHUSER
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("SearchUser",function(Data,Callback)
	Callback(vSERVER.SearchUser(Data.Search))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- MEMBERS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Members",function(Data,Callback)
	Callback(vSERVER.Members(Data.Ranking))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TAGS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Tags",function(Data,Callback)
	Callback(vSERVER.Tags())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- GETTAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("GetTag",function(Data,Callback)
	Callback(vSERVER.GetTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CREATETAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("CreateTag",function(Data,Callback)
	Callback(vSERVER.CreateTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATETAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("UpdateTag",function(Data,Callback)
	Callback(vSERVER.UpdateTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ASSIGNTAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("AssignTag",function(Data,Callback)
	Callback(vSERVER.AssignTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REMOVETAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("RemoveTag",function(Data,Callback)
	Callback(vSERVER.RemoveTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DESTROYTAG
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("DestroyTag",function(Data,Callback)
	Callback(vSERVER.DestroyTag(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- INVITE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Invite",function(Data,Callback)
	Callback(vSERVER.Invite(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- HIERARCHY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Hierarchy",function(Data,Callback)
	Callback(vSERVER.Hierarchy(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DISMISS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Dismiss",function(Data,Callback)
	Callback(vSERVER.Dismiss(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ANNOUNCEMENTS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Announcements",function(Data,Callback)
	Callback(vSERVER.Announcements())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CREATEANNOUNCEMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("CreateAnnouncement",function(Data,Callback)
	Callback(vSERVER.CreateAnnouncement(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATEANNOUNCEMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("UpdateAnnouncement",function(Data,Callback)
	Callback(vSERVER.UpdateAnnouncement(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DESTROYANNOUNCEMENT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("DestroyAnnouncement",function(Data,Callback)
	Callback(vSERVER.DestroyAnnouncement(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- PERKS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Perks",function(Data,Callback)
	Callback(vSERVER.Perks())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- PERKSBUY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("PerksBuy",function(Data,Callback)
	Callback(vSERVER.PerksBuy(Data.Id))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- BANK
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Bank",function(Data,Callback)
	Callback(vSERVER.Bank())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DEPOSITBANK
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("DepositBank",function(Data,Callback)
	Callback(vSERVER.DepositBank(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- WITHDRAWBANK
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("WithdrawBank",function(Data,Callback)
	Callback(vSERVER.WithdrawBank(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TRANSFERBANK
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("TransferBank",function(Data,Callback)
	Callback(vSERVER.TransferBank(Data))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- PAINEL:NOTIFY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("painel:Notify")
AddEventHandler("painel:Notify",function(Title,Message,Type)
	SendNUIMessage({ Action = "Notify", Payload = { Title,Message,Type } })
end)